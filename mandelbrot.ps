#version 330 core

in vec4 vOutColor;
in vec4 vWorldPos;

out vec4 vEndColor;

void main() {
	int Count = 0;
	vec4 Z = vec4(0, 0, 0, 0);

	vec2 Coord;
	Coord.x = vWorldPos.x*5.5-0.5;
	Coord.y = vWorldPos.y*5.5;


	while(dot(Z.xy,Z.xy) < 4) {	
		if(Count == 300) {
			vEndColor = vec4(0, 0, 0, 0);
			return;
		}
		Z.z  = dot(Z.xy,Z.xy);
		Z.w  = atan(Z.y/Z.x);
		if(Z.x < 0) Z.w += radians(180.0f);
		Z.x = Z.z*cos(2*Z.w)+Coord.x;
		Z.y = Z.z*sin(2*Z.w)+Coord.y;
		
		Count++;
	}

	if(Count < 20) vEndColor = vec4(1,float(Count)/20,0,1);
	else if(Count < 50) vEndColor  = vec4(float(50-Count)/30,1,0.1,1);
	else if(Count < 90) vEndColor  = vec4(0.1,1,float(Count-50)/40,1);
	else if(Count < 140) vEndColor = vec4(0.1,float(140-Count)/50,1,1);
	else if(Count < 200) vEndColor = vec4(float(Count-140)/60,0.1,1,1);
	else if(Count < 270) vEndColor = vec4(float(270-Count)/70,0.1,float(270-Count)/70,1);
	else vEndColor = vec4(1, 0, 1, 0);
}